---
title: "GO Semantic Similarity"
author: "Danielle Becker"
date: "Last updated 2023/06/27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Prepare workspace
```{r, message=FALSE, warning=FALSE}
rm(list=ls()) # removes all prior objects
library(tidyverse)
library(org.Hs.eg.db)
library(simplifyEnrichment)
library(magick)
library(gridtext)
library(clusterProfiler)
library(enrichplot)
# we use ggplot2 to add x axis labels (ex: ridgeplot)
library(ggplot2)
```

#Use simplifyenrichment package (http://www.bioconductor.org/packages/release/bioc/vignettes/simplifyEnrichment/inst/doc/simplifyEnrichment.html) to calculate semantic similarity for GO terms in gene expression and methylation
#All dataframes were made in RAnalysis - Scripts - Host - Host_GO_KEGG_Enrichment_Analysis_Func_Annot

#Create semantic similarity matrices for differentially expressed gene categories

Load GO data and select only the GO_IDs associated with BP terms
```{r, message=FALSE, warning=FALSE}
  MatGO <- read_csv("RAnalysis/Data/RNA-seq/P.verrucosa/Host/DEG_GO_parent_terms_complete.csv", col_names = TRUE)
nrow(MatGO) # total #enriched terms 307
nrow(filter(MatGO, ontology=="BP")) #BP terms 210
nrow(filter(MatGO, ontology=="CC")) #CC terms 27
nrow(filter(MatGO, ontology=="MF")) #MF terms 70
MatGO.BP <- MatGO %>% filter(ontology == "BP")
MatBP <- MatGO.BP$category
MatGO.MF <- MatGO %>% filter(ontology == "MF")
MatMF <- MatGO.MF$category
MatGO.CC <- MatGO %>% filter(ontology == "CC")
MatCC <- MatGO.CC$category
```


Calculate a similarity matrix and save the output.
```{r}
Mat = GO_similarity(MatBP, ont = "BP", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DEG_BP_plot.pdf", width = 7, height = 5)
simplifyGO(Mat, word_cloud_grob_param = list(max_width = 50), max_words=20)
dev.off()

MatMF = GO_similarity(MatMF, ont = "MF", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DEG_MF_plot.pdf", width = 7, height = 5)
simplifyGO(MatMF, word_cloud_grob_param = list(max_width = 50), max_words=20)
dev.off()

MatCC = GO_similarity(MatCC, ont = "CC", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DEG_CC_plot.pdf", width = 7, height = 5)
simplifyGO(MatCC, word_cloud_grob_param = list(max_width = 50), max_words=20)
dev.off()
```


#Create semantic similarity matrices for differentially methylated gene categories
Load GO data and select only the GO_IDs associated with BP terms
```{r, message=FALSE, warning=FALSE}
DMG <- read_csv("RAnalysis/Data/WGBS/DMG_GO_parent_terms_complete.10x.csv", col_names = TRUE)
nrow(DMG) # total #enriched terms 118
nrow(filter(DMG, ontology=="BP")) #BP terms 74
nrow(filter(DMG, ontology=="CC")) #CC terms 6
nrow(filter(DMG, ontology=="MF")) #MF terms 38

DMG.BP <- DMG %>% filter(ontology == "BP") 
DMGBP <- DMG.BP$category

DMG.MF <- DMG %>% filter(ontology == "MF")
DMGMF <- DMG.MF$category

DMG.CC <- DMG %>% filter(ontology == "CC")
DMGCC <- DMG.CC$category
```

Calculate a similarity matrix and save the output.
```{r}
DMG_BP = GO_similarity(DMGBP, ont = "BP", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DMG_BP_plot.pdf", width = 7, height = 5)
simplifyGO(DMGBP, word_cloud_grob_param = list(max_width = 50), max_words=20)
dev.off()

DMG_MF = GO_similarity(DMGMF, ont = "MF", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DMG_MF_plot.pdf", width = 7, height = 5)
simplifyGO(DMGMF, word_cloud_grob_param = list(max_width = 50), max_words=20)
dev.off()

DMG_CC = GO_similarity(DMGCC, ont = "CC", db = "org.Hs.eg.db")
pdf(file = "RAnalysis/Output/RNA-seq/Semantic_similarity/DMG_CC_plot.pdf", width = 7, height = 5)
simplifyGO(DMGCC, word_cloud_grob_param = list(max_width = 50), max_words=20, ont = "CC")
dev.off()
```
#try using clusterprofiler for the same thing

```{r}
#make annotation using gff and gaf for Pocillopora verrucosa
```


