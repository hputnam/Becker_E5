---
title: "DEG_DMG_pathway_analysis"
author: "daniellembecker"
date: "2023-01-20"
output: html_document
editor_options: 
  chunk_output_type: inline
---


# Molecular Underpinnings Chronic Nutrient Enrichment Project

## Analysis of comparisons between gene ontology enrichment from differentially methylated genes and differentially expressed genes.
## Previous steps for gene expression include RNAseq workflow in Bioinformatics>RNAseq>RNAseq workflow and Differential Gene Expression statistical analysis in RAnalysis>Scripts>RNAseq_Differential_Gene_Expression to make DEG statistical data sheet
## Previous steps for DNA methylation include WGBS workflow in Bioinformatics>WGBS>WGBS workflow and Differential Methylated Genes statistical analysis in RAnalysis>Scripts>WGBS_WGBS.rmd to make DMG statistical dataframe

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries

library("tidyverse")
library("RColorBrewer")
library("gridExtra")
library("ComplexHeatmap")
library("dplyr")
library("clusterProfiler")
library("pheatmap")
library("magrittr")
library("rtracklayer")
library("GenomicRanges")
library("png")
library("GSEABase")
library("GOSim")
library("VennDiagram")
library("stats")
library("GO.db")
library("rrvgo")
library("GOSemSim")
library("AnnotationDbi")
library("janitor")
library(rtracklayer) # on bioconducter
library(dplyr)
library(edgeR)
library(factoextra)
library(cowplot)
library(wesanderson)
library(viridis)
library(adegenet)
library(ggplot2)
library(matrixStats)
library(grid)
library(gridExtra)
library(RColorBrewer)
library(patchwork)
library(stringr)
library(tidyverse)
library(ggpubr)
pal <- brewer.pal(n = 3, name = "PRGn")
```

# Import the data files 
```{r}
#upload go enrichment summary for DEGs
DEG <- read.csv("RAnalysis/Data/RNA-seq/P.verrucosa/Host/DEG_GO_parent_terms_complete.csv", header = TRUE)

#adjust p-values 
DEG$bh_adjust <-  p.adjust(DEG$over_represented_pvalue, method="BH") 

#rename category to GOterm
colnames(DEG)[3] ="GOterm" #rename columns

#write csv with bh_adjust
write.csv(DEG, file = "RAnalysis/Output/RNA-seq/GOSeq/Host/GO.DEG.parent.terms.host.csv")

#upload go enrichment summary for DMGs
DMG <- read.csv("RAnalysis/Output/WGBS/GO.enrichment.summary.table.ontology.5x.csv", header = TRUE, row.names = 1)

#rename category to GOterm
colnames(DMG)[3] ="GOterm" #rename columns

#add column to specific type of measure
DMG <- DMG %>% add_column(type = "DMG.GO.terms")

#adjust p-values 
DMG$bh_adjust <-  p.adjust(DMG$over_represented_pvalue, method="BH") 


#write csv with bh_adjust
write.csv(DMG, file = "RAnalysis/Output/WGBS/GO.DMG.parent.terms.csv")

```



```{r}
#use dplyr inner_join instead

common <- intersect(DMG$term, DEG$term) 

common <- as.data.frame(common)

#found three common terms for DMG and DEG

#leukocyte migration involved in inflammatory response (parent term cell motility, immune system response, response to stress)

#positive regulation of transcription from RNA polymerase II promoter in response to heat stress (DNA-templated transcription; response to stress; nitrogen compound metabolic process)

#fatty acid derivative biosynthetic process (lipid metabolic process)

#main question is why 10x terms have three overlapping but 5x does not
```

#next steps, fill in remaining parent terms for the NAs in these data sets and see the overlap there
#filter datas sets with NAs for their slim terms
```{r}
DMG.NA <- DMG %>%
  filter(is.na(slim_term))

DEG.NA <- DEG %>%
  filter(is.na(slim_term))
```


#Filled in all NAs with parent terms for completed data frames below
#Used QuickGO to search and fill in the remaining NA parent terms https://www.ebi.ac.uk/QuickGO/term/GO:1901363
#DMG go plot
```{r}
#upload complete parent term dataframe DMGs and make figures

#upload complete go enrichment summary for DMGs
DMG.complete <- read.csv("RAnalysis/Data/WGBS/DMG_GO_parent_terms_complete.10x.csv", header = TRUE)

#adjust p-values 
DMG.complete$bh_adjust <-  p.adjust(DMG.complete$over_represented_pvalue, method="BH") 

GO.plot.DMG.complete <-  ggplot(DMG.complete, aes(x = ontology, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,2120))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Ontology Category")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE))+
    ggtitle("")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0),
          axis.title.y = element_blank())

 
ggsave("RAnalysis/Output/WGBS/DMG.complete.slimterms.pdf", GO.plot.DMG.complete, width = 20, height = 49.5, units = c("in"))
ggsave("RAnalysis/Output/WGBS/DMG.complete.slimterms.png", GO.plot.DMG.complete, width = 20, height = 49.5, units = c("in"))


```




```{r}
#upload complete parent term dataframe DMGs and make figures

#upload complete go enrichment summary for DMGs
DEG.complete <- read.csv("RAnalysis/Data/RNA-seq/P.verrucosa/Host/DEG_GO_parent_terms_complete.csv", header = TRUE)

#add column to specific type of measure
#DEG.complete <- DEG.complete %>% add_column(type = "DEG.GO.terms")


#adjust p-values 
DEG.complete$bh_adjust <-  p.adjust(DEG.complete$over_represented_pvalue, method="BH") 



GO.plot.DEG.complete <-  ggplot(DEG.complete, aes(x = ontology, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,550))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Ontology Category")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE))+
    ggtitle("")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0),
          axis.title.y = element_blank())

 
ggsave("RAnalysis/Output/Final_Figures/Host/DEG.complete.slimterms.pdf", GO.plot.DEG.complete , width = 25, height = 49, units = c("in"))


```


#load png image of DEG PCA and DMG PCA to combine for each figure
```{r}
DEG.PCA <- readPNG("RAnalysis/Output/Final_Figures/Host/DEGSeq2_DEG_PCA_plot_host.png")
PCA.DEG <- rasterGrob(DEG.PCA, interpolate=TRUE)

DMG.PCA <- readPNG("RAnalysis/Output/Final_Figures/Host/DMG_PCA_plot_host.png")
PCA.DMG <- rasterGrob(DMG.PCA, interpolate=TRUE)

```

#make DEG plot figure 2 manuscript
```{r}

#filter for numincat sum per term and remove CC ontology for dataframe before making plot BP
filter.DEG.BP <-DEG.complete %>%
  filter(ontology %in% c("BP"))

filt.sum.DEG.BP <- filter.DEG.BP %>% group_by(slim_term) %>% 
  summarise(sum_num=sum(numInCat))

filt.mean.DEG.BP <- filter.DEG.BP %>% group_by(slim_term) %>% 
  summarise(pvalue=mean(bh_adjust))

subset.DEG.BP <- left_join(filt.mean.DEG.BP, filt.sum.DEG.BP)

subset.DEG.BP <- subset.DEG.BP %>%
  mutate(ontology = "Biological Process")

GO.plot.DEG.BP <-  ggplot(subset.DEG.BP, aes(x = ontology, y = slim_term)) + 
    geom_point(aes(size=sum_num, fill=pvalue, colour=pvalue)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,800))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE), switch="y")+
    ggtitle("")+
    theme_bw() + 
    #scale_y_discrete(limits=rev) +
    theme(strip.text.y.left = element_text(angle = 0),
          panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 30, face="bold"),
          axis.text.x = element_text(size = 30, face="bold"),
          axis.text.y=element_blank(),
          axis.ticks.y = element_blank(),
          axis.title.x = element_text(size = 30, face="bold"),
          legend.text=element_text(size=30, face="bold"),
          title=element_text(size=30, face="bold"),
          plot.title = element_text(hjust = 0, face="bold"),
          axis.title.y = element_blank())

ggsave("RAnalysis/Output/RNA-seq/DEG/Host/DEG.BP.png", GO.plot.DEG.BP, width = 20, height = 40, units = c("in"))
ggsave("RAnalysis/Output/RNA-seq/DEG/Host/DEG.BP.pdf", GO.plot.DEG.BP, width = 20, height = 20, units = c("in"))


#filter for numincat sum per term and remove CC ontology for dataframe before making plot BP
filter.DEG.MF <-DEG.complete %>%
  filter(ontology %in% c("MF"))

filt.sum.DEG.MF <- filter.DEG.MF%>% group_by(slim_term) %>% 
  summarise(sum_num=sum(numInCat))

filt.mean.DEG.MF <- filter.DEG.MF %>% group_by(slim_term) %>% 
  summarise(pvalue=mean(bh_adjust))

subset.DEG.MF <- left_join(filt.mean.DEG.MF, filt.sum.DEG.MF)

subset.DEG.MF <- subset.DEG.MF %>%
  mutate(ontology = "Molecular Function")

GO.plot.DEG.MF <-  ggplot(subset.DEG.MF, aes(x = ontology, y = slim_term)) + 
    geom_point(aes(size=sum_num, fill=pvalue, colour=pvalue)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,1455))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE), switch="y")+
    ggtitle("")+
    theme_bw() + 
    #scale_y_discrete(limits=rev) +
    theme(strip.text.y.left = element_text(angle = 0),
          panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 30, face="bold"),
          axis.text.x = element_text(size = 30, face="bold"),
          axis.text.y=element_blank(),
          axis.ticks.y = element_blank(),
          axis.title.x = element_text(size = 30, face="bold"),
          legend.text=element_text(size=30, face="bold"),
          title=element_text(size=30, face="bold"),
          plot.title = element_text(hjust = 0, face="bold"),
          axis.title.y = element_blank())

ggsave("RAnalysis/Output/RNA-seq/DEG/Host/DEG.MF.png", GO.plot.DEG.MF, width = 10, height = 10, units = c("in"))
ggsave("RAnalysis/Output/RNA-seq/DEG/Host/DEG.MF.pdf", GO.plot.DEG.MF, width = 10, height = 10, units = c("in"))

```

#make DMG figure 3 for manuscript 
```{r}

#filter for numincat sum per term and remove CC ontology for dataframe before making plot BP
filter.DMG.BP <-DMG.complete %>%
  filter(ontology %in% c("BP"))

filt.sum.BP <- filter.DMG.BP %>% group_by(slim_term) %>% 
  summarise(sum_num=sum(numInCat))

filt.mean.BP <- filter.DMG.BP %>% group_by(slim_term) %>% 
  summarise(pvalue=mean(bh_adjust))

subset.BP <- left_join(filt.mean.BP, filt.sum.BP)

subset.BP <- subset.BP %>%
  mutate(ontology = "Biological Process")

GO.plot.DMG.BP <-  ggplot(subset.BP, aes(x = ontology, y = slim_term)) + 
    geom_point(aes(size=sum_num, fill=pvalue, colour=pvalue)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,1528))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE), switch="y")+
    ggtitle("")+
    theme_bw() + 
    #scale_y_discrete(limits=rev) +
    theme(strip.text.y.left = element_text(angle = 0),
          panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 30, face="bold"),
          axis.text.x = element_text(size = 30, face="bold"),
          axis.text.y=element_blank(),
          axis.ticks.y = element_blank(),
          axis.title.x = element_text(size = 30, face="bold"),
          legend.text=element_text(size=30, face="bold"),
          title=element_text(size=30, face="bold"),
          plot.title = element_text(hjust = 0, face="bold"),
          axis.title.y = element_blank())

ggsave("RAnalysis/Output/WGBS/DMG.BP.png", GO.plot.DMG.BP, width = 20, height = 35, units = c("in"))
ggsave("RAnalysis/Output/WGBS/DMG.BP.pdf", GO.plot.DMG.BP, width = 20, height = 20, units = c("in"))


#filter for numincat sum per term and remove CC ontology for dataframe before making plot BP
filter.DMG.MF <-DMG.complete %>%
  filter(ontology %in% c("MF"))

filt.sum.MF <- filter.DMG.MF%>% group_by(slim_term) %>% 
  summarise(sum_num=sum(numInCat))

filt.mean.MF <- filter.DMG.MF %>% group_by(slim_term) %>% 
  summarise(pvalue=mean(bh_adjust))

subset.MF <- left_join(filt.mean.MF, filt.sum.MF)

subset.MF <- subset.MF %>%
  mutate(ontology = "Molecular Function")

GO.plot.DMG.MF <-  ggplot(subset.MF, aes(x = ontology, y = slim_term)) + 
    geom_point(aes(fill=pvalue, colour=pvalue, size=sum_num)) + 
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,5600))+
    xlab("")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE), switch="y")+
    ggtitle("")+
    theme_bw() + 
    #scale_y_discrete(limits=rev) +
    theme(strip.text.y.left = element_text(angle = 0),
          panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 30, face="bold"),
          axis.text.x = element_text(size = 30, face="bold"),
          axis.text.y=element_blank(),
          axis.ticks.y = element_blank(),
          axis.title.x = element_text(size = 30, face="bold"),
          legend.text=element_text(size=30, face="bold"),
          title=element_text(size=30, face="bold"),
          plot.title = element_text(hjust = 0, face="bold"),
          axis.title.y = element_blank())

ggsave("RAnalysis/Output/WGBS/DMG.MF.png", GO.plot.DMG.MF, width = 10, height = 10, units = c("in"))
ggsave("RAnalysis/Output/WGBS/DMG.MF.pdf", GO.plot.DMG.MF, width = 10, height = 10, units = c("in"))



```

#use patchwork to make figure 2 and 3 wiht PCA as a, BP as B and MF as C for DEG and DMG

```{r}

bottom_row.DEG <- plot_grid(GO.plot.DEG.BP, GO.plot.DEG.MF, label_size = 60)
Figure2 <- plot_grid(PCA.DEG, bottom_row.DEG, labels = c('A', ''), label_size = 60, ncol = 1) 

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/DEG.png"), plot=Figure2, dpi=300,width=50, height=60, units="in", limitsize = FALSE)
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/DEG.pdf"), plot=Figure2, dpi=300, width=50, height=60, units="in", limitsize = FALSE)

bottom_row.DMG <- plot_grid(GO.plot.DMG.BP, GO.plot.DMG.MF, label_size = 60)
Figure3 <- plot_grid(PCA.DMG, bottom_row.DMG, labels = c('A', ''), label_size = 60, ncol = 1)

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/DMG.png"), plot=Figure3, dpi=300,width=50, height=60, units="in", limitsize = FALSE)
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/DMG.pdf"), plot=Figure3, dpi=300, width=50, height=60, units="in", limitsize = FALSE)
```




#facet by ontology, x axis of dot plots could be genes and methylation to see which are shared and each ontology level what is overlap in each
#see next is how gene and meth functions overlap facet grouping by parent term and which gives you overlap in parent terms
#DEG go plot
```{r}
#add column for deg dmg specific category to each dataframe
DMG.complete <- DMG.complete %>% add_column(type = "DMG.GO.terms")

#rename column from genes to gene
DEG.complete <- DEG.complete %>% 
       dplyr::rename("GOterm" = "category")

#rename column from genes to gene
DMG.complete <- DMG.complete %>% 
       dplyr::rename("GOterm" = "category")


#combine two dataframes to have both DEG and DMG terms in same data frame
DEG.DMG <- rbind(DMG.complete, DEG.complete)

#filter for just the biological process ontology
DEG.DMG.BP <- DEG.DMG %>%
filter(ontology == "BP")

#output csv of shared DMG and DEG terms
write.csv(DEG.DMG, "RAnalysis/Output/meth_express_compare/global.DEG.DMG.goterms.csv")

BP.df <- na.omit(DEG.DMG.BP)


#make biological process DEG DMG comparison figure
GO.plot.BP.DEG.DMG <-  ggplot(BP.df, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,550))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Method")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 80, multi_line = TRUE))+
    ggtitle("Biological Process")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.5),
          axis.title.y = element_blank());GO.plot.BP.DEG.DMG

 

ggsave("RAnalysis/Output/Final_Figures/Host/GO.BP.DEG.DMG.pdf", GO.plot.BP.DEG.DMG , width = 35, height = 49, units = c("in"))

```








#make final DMG DEG molecular function comparison plot
```{r}
#filter for just the molecular function ontology
DEG.DMG.MF <- DEG.DMG %>%
filter(ontology == "MF")

#make biological process DEG DMG comparison figure
GO.plot.MF.DEG.DMG <-  ggplot(DEG.DMG.MF, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,550))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Method")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE))+
    ggtitle("Molecular Function")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.5),
          axis.title.y = element_blank());GO.plot.MF.DEG.DMG

 

ggsave("RAnalysis/Output/Final_Figures/Host/GO.MF.DEG.DMG.pdf", GO.plot.MF.DEG.DMG , width = 20, height = 49, units = c("in"))

```


#make final DMG DEG cellular component comparison plot
```{r}
#filter for just the molecular function ontology
DEG.DMG.CC <- DEG.DMG %>%
filter(ontology == "CC")

#make biological process DEG DMG comparison figure
GO.plot.CC.DEG.DMG <-  ggplot(DEG.DMG.CC, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,550))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Method")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE))+
    ggtitle("Cellular Component")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.5),
          axis.title.y = element_blank());GO.plot.CC.DEG.DMG

 

ggsave("RAnalysis/Output/Final_Figures/Host/GO.CC.DEG.DMG.pdf", GO.plot.CC.DEG.DMG , width = 20, height = 30, units = c("in"))

```


#Filter dataframes for gene ontology groups that are involved in nitrogen pathways, stress pathways to see if expression and methylation are correlated
```{r}
#filter by any category that contained the word, could do anything that has the word nitrogen, stress, and heat 

vector1 <- c("nitrogen", "oxygen", "glucose", "carbon", "heat", "nutrient", "carbohydrate", "oxidative", "protein metabolic process", "amino acid", "oxidoreductase activity", "DNA replication", "DNA repair", "immune", "protein folding", "stress", "protein modification process", "protein transport", "DNA")

phenotype.pathways.DEG <-DEG.complete%>%
      filter(grepl(paste(vector1, collapse="|"), paste(slim_term, term))) 

phenotype.pathways.DMG <- DMG.complete %>% 
      filter(grepl(paste(vector1, collapse="|"), paste(slim_term, term))) 

```

#change data frames from wide to long format
```{r}
#change data frames from wide to long so each gene has a row 
long.pathway.DEG <- phenotype.pathways.DEG %>% 
    mutate(genes = strsplit(as.character(genes), ",")) %>% #defines what character separates the list
    unnest(genes) #unnests and makes each gene have its own row

#rename column from genes to gene
long.pathway.DEG <- long.pathway.DEG %>% 
       dplyr::rename("gene_id" = "genes")

#remove type column from data frame to match DMG 
long.pathway.DEG = subset(long.pathway.DEG, select = -c(type) )

#remove extra first space in gene_id names in column 
long.pathway.DEG$gene_id <- gsub(' Pver', 'Pver', long.pathway.DEG$gene_id)

#change data frames from wide to long so each gene has a row
long.pathway.DMG <- phenotype.pathways.DMG %>% 
    mutate(genes = strsplit(as.character(genes), ",")) %>% 
    unnest(genes)

#remove the _gene_ in the DMG gene list to match DEG gene numbers
long.pathway.DMG$genes <-  gsub("_gene_","_", long.pathway.DMG$genes)

#rename column from genes to gene
long.pathway.DMG <- long.pathway.DMG %>% 
       dplyr::rename("gene_id" = "genes")

#remove extra first space in gene_id names in column 
long.pathway.DMG$gene_id <- gsub(' Pver', 'Pver', long.pathway.DMG$gene_id)

```


#compare gene lists for correlation, DEG, DMG need to bring in statistic data frame
```{r}
#methylation and expression dataframe calculated and complete in meth_GE_compare.Rmd script, found here: https://github.com/hputnam/Becker_E5/blob/master/RAnalysis/Scripts/methyl_expression_compare/meth_GE_compare.Rmd
#this data frame lists only the genes found in meth and express data frames
meth.express <- readRDS("RAnalysis/Data/GE_meth_compare/Multi_geneSummaryComplete.RData")

#remove _gene_ in gene id to match other data frames
meth.express$gene_id <-  gsub("_gene_","_", meth.express$gene_id)

#this data frame lists all methylated genes found 
methyl.annot <- readRDS("RAnalysis/Data/GE_meth_compare/meth_annot_full.RData")

#remove _gene_ in gene id to match other data frames
methyl.annot$gene_id <-  gsub("_gene_","_", methyl.annot$gene_id)

#this data frame lists all expressed genes found
express.annot <- readRDS("RAnalysis/Data/GE_meth_compare/gene_annot_full.RData")

#remove _gene_ in gene id to match other data frames
express.annot$gene_id <-  gsub("_gene_","_", express.annot$gene_id)

#remove gene_ from column 2 to 8
colnames(express.annot)[2:8] <-  sub(".*gene_", "", colnames(express.annot)[2:8])

```


```{r}
#combine DMG and DEG data frames, by binding below so all rows are present

#add column to specific type of measure
long.pathway.DEG <- long.pathway.DEG %>% add_column(type = "DEG.GO.terms")


#DMG columns = 12 rows and DEG = 435 rows, total rows should be 447
DMG.DEG.dat <- rbind(long.pathway.DEG, long.pathway.DMG)
#yes rows equal estimate

#write hypothesis driven csv
write.csv(DMG.DEG.dat, "RAnalysis/Output/meth_express_compare/hypothesis.DEG.DMG.goterms.csv")
```

```{r}
#combine all meth express data frame with DMG.DEG data frame
#this will merge only genes found in both DMG and DEG
meth.exp.filt <- merge(meth.express, DMG.DEG.dat, by = 'gene_id')

#this will merge to list all DEG and DMG express and meth statistics
#all DMG rows should stay = 12, only 9
meth.merge <- merge(methyl.annot, long.pathway.DMG)

#all DEG rows should stay = 435, only 410
express.merge <- merge(express.annot, long.pathway.DEG, by = 'gene_id')

#the reason some expressed or methylated genes do not merge with stats are due to filtering for >3 CpG in methylation and >0 mean expression


```


#look at comparisons between genes in control and enriched, calculate unique gene_ids in both control and enriched and number that are shared between the two groups, venn diagram
```{r}
## Mean Methylation vs Gene Expression following Liew et al
df <- meth.exp.filt

df %>% drop_na()

#control log gene expression x % methylation
df$log_gene <- log(df$gene_mean_express+1)
df$per_meth <- df$mean_meth * 100

#make plot with correlation tests
#decide between pearson, kendall, or spearman
#first test normality
shapiro.test(df$gene_mean_express) # <0.05
shapiro.test(df$mean_meth) # <0.05
#both variables are less then 0.05 indicating data do not follow normal distribution

#use kendall test for correlation, Kendall’s is more robust and generally the preferred method between spearman and kendall

meth.express.specific <- ggplot(df,aes(x=per_meth, y=log_gene,)) + 
    geom_point() + 
    geom_smooth(method=lm,colour="orange",size=2,na.rm = TRUE) +
    scale_color_viridis() +
    labs(x="DNA Methylation (%)", y = "log10 (mean expression +1)") +
  stat_cor(method = "kendall", digits = 3, label.x = 60, label.y = 0.5 ) +
    theme_cowplot();meth.express.specific



### Figure Mean Methylation vs Gene Expression###

ggsave(meth.express.specific, filename="RAnalysis/Output/meth_express_compare/pathway.specific.express.meth.png", height = 7, width = 10)
```



#look at comparisons between genes in control and enriched, calculate unique gene_ids in both control and enriched and number that are shared between the two groups, venn diagram
```{r}
## Mean Methylation vs Gene Expression following Liew et al

#control log gene expression x % methylation
df$log_gene_C <- log(df$gene_mean_express_C+1)
df$per_meth_C <- df$mean_meth_C * 100

#make plot with correlation tests
#decide between pearson, kendall, or spearman
#first test normality
shapiro.test(df$gene_mean_express_C) # <0.05
shapiro.test(df$mean_meth_C) # <0.05
#both variables are less then 0.05 indicating data do not follow normal distribution

#use kendall test for correlation, Kendall’s is more robust and generally the preferred method between spearman and kendall
control <- ggplot(df, aes(x=per_meth_C, y=log_gene_C)) + 
    geom_point() + ylim(0,3) + xlim(0,100) +
    geom_smooth(method=lm, colour="orange",size=2,na.rm = TRUE) +
    stat_cor(method = "kendall", digits = 3, label.x = 60, label.y = 0.5 ) +
    scale_color_viridis() +
    labs(x="DNA Methylation (%)", y = "log10 (mean expression +1)") +
    theme_cowplot();control


#enriched log gene expression x % methylation
df$log_gene_E <- log(df$gene_mean_express_E+1)
df$per_meth_E <- df$mean_meth_E * 100

#make plot with correlation tests
#decide between pearson, kendall, or spearman
#first test normality
shapiro.test(df$gene_mean_express_E) # <0.05
shapiro.test(df$mean_meth_E) # <0.05
#both variables are less then 0.05 indicating data do not follow normal distribution

#use kendall test for correlation, Kendall’s is more robust and generally the preferred method between spearman and kendall
enriched <- ggplot(df,aes(x=per_meth_E,y=log_gene_E, cor.coef = TRUE, cor.method = "pearson")) + 
    geom_point() + ylim(0,3) + xlim(0,100) +
    geom_smooth(method=lm,colour="orange",size=2,na.rm = TRUE) +
    stat_cor(method = "kendall", digits = 3, label.x = 60, label.y = 0.5 ) +
    scale_color_viridis() +
    labs(x="DNA Methylation (%)", y = "log10 (mean expression +1)") +
    theme_cowplot();enriched



### Figure Mean Methylation vs Gene Expression###

meth_meanexpress <- control + labs(title = "", subtitle = "Control") + enriched + labs(title = "", subtitle = "Enriched")

meth_meanexpress

ggsave(meth_meanexpress, filename="RAnalysis/Output/meth_express_compare/treatment.pathway.specific.express.meth.png", height = 7, width = 15)
```

```{r}
#find unique GO slim terms that overlap between DEG and DMG lists
test1 <- unique(DEG.complete$slim_term)
test1 <- data_frame(test1)
test1 <- test1 %>% 
       rename("slim_term" = "test1")

test2 <- unique(DMG.complete$slim_term)
test2 <- data_frame(test2)
test2 <- test2 %>% 
       rename("slim_term" = "test2")

test3 <- merge(test1, test2, on="slim_term")
#23 unique terms

#make biological process DEG DMG comparison figure
hypo.DEG.DMG <-  ggplot(df, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,2000))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    xlab("Method")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 55, multi_line = TRUE))+
    #ggtitle()+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.5),
          axis.title.y = element_blank());hypo.DEG.DMG

ggsave("RAnalysis/Output/Final_Figures/Host/GO.hypo.DEG.DMG.pdf", hypo.DEG.DMG , width = 20, height = 30, units = c("in"))
ggsave("RAnalysis/Output/Final_Figures/Host/GO.hypo.DEG.DMG.png", hypo.DEG.DMG , width = 20, height = 30, units = c("in"))

length(unique(DEG.complete$slim_term)) # 75 unique GO slim terms

```

#make dataframes and figures for specific hypothesis driven pathways and responses from DEGs and DMGs

#nutrient response
```{r}

nutrient <- c("nutrient")

nutrient.DEG <-DEG.complete%>%
      filter(grepl(paste(nutrient, collapse="|"), paste(slim_term, term))) 

nutrient.DMG <- DMG.complete %>% 
      filter(grepl(paste(nutrient, collapse="|"), paste(slim_term, term)))

nutrient.dat <- rbind(nutrient.DEG,nutrient.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  nutrient.GO.plot <-  ggplot(nutrient.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,50))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 6, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Nutrient Response")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.6),
          axis.title.y = element_blank())
  
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/nutrient.DMG.DEG.png"), plot=nutrient.GO.plot, dpi=300, width=15, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/nutrient.DMG.DEG.pdf"), plot=nutrient.GO.plot, dpi=300, width=15, height=10, units="in")

```

#nitrogen metabolism
```{r}

nitrogen <- c("nitrogen")

nitrogen.DEG <-DEG.complete%>%
      filter(grepl(paste(nitrogen, collapse="|"), paste(slim_term, term))) 

nitrogen.DMG <- DMG.complete %>% 
      filter(grepl(paste(nitrogen, collapse="|"), paste(slim_term, term)))

nitrogen.dat <- rbind(nitrogen.DEG,nitrogen.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  nitrogen.GO.plot <-  ggplot(nitrogen.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,100))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 8, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Nitrogen Metabolism")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.6),
          axis.title.y = element_blank())
  
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/nitrogen.DMG.DEG.png"), plot=nitrogen.GO.plot, dpi=300, width=15, height=15, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/nitrogen.DMG.DEG.pdf"), plot=nitrogen.GO.plot, dpi=300, width=15, height=15, units="in")

```

#heat stress response
```{r}

heat <- c("heat", "DNA replication", "DNA repair", "immune", "protein folding", "stress", "DNA")

heat.DEG <-DEG.complete%>%
      filter(grepl(paste(heat, collapse="|"), paste(slim_term, term))) 

heat.DMG <- DMG.complete %>% 
      filter(grepl(paste(heat, collapse="|"), paste(slim_term, term)))

heat.dat <- rbind(heat.DEG,heat.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  heat.GO.plot <-  ggplot(heat.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,1500))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 50, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Heat Stress Response")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.6),
          axis.title.y = element_blank())
  
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/heat.DMG.DEG.png"), plot=heat.GO.plot, dpi=300, width=22, height=15, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/heat.DMG.DEG.pdf"), plot=heat.GO.plot, dpi=300, width=22, height=15, units="in")


```


#carbohydrate metabolism
```{r}

carb <- c("carbohydrate")

carb.DEG <-DEG.complete%>%
      filter(grepl(paste(carb, collapse="|"), paste(slim_term, term))) 

carb.DMG <- DMG.complete %>% 
      filter(grepl(paste(carb, collapse="|"), paste(slim_term, term)))

carb.dat <- rbind(carb.DEG,carb.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  carb.GO.plot <-  ggplot(carb.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,50))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 8, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Carbohydrate Metabolism")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.6),
          axis.title.y = element_blank())
  
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/carb.DMG.DEG.png"), plot=carb.GO.plot, dpi=300, width=15, height=15, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/carb.DMG.DEG.pdf"), plot=carb.GO.plot, dpi=300, width=15, height=15, units="in")
 

```

#amino acid metabolism
```{r}

amino <- c("amino acid", "amino")

amino.DEG <-DEG.complete%>%
      filter(grepl(paste(amino, collapse="|"), paste(slim_term, term))) 

amino.DMG <- DMG.complete %>% 
      filter(grepl(paste(amino, collapse="|"), paste(slim_term, term)))

amino.dat <- rbind(amino.DEG,amino.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  amino.GO.plot <-  ggplot(amino.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,35))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 8, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Amino Acid Metabolism")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/amino.DMG.DEG.png"), plot=amino.GO.plot, dpi=300, width=14, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/amino.DMG.DEG.pdf"), plot=amino.GO.plot, dpi=300, width=14, height=10, units="in")

```

#oxidoreductase activity
```{r}

oxy <- c("oxygen", "oxidative", "oxidoreductase activity")

oxy.DEG <-DEG.complete%>%
      filter(grepl(paste(oxy, collapse="|"), paste(slim_term, term))) 

oxy.DMG <- DMG.complete %>% 
      filter(grepl(paste(oxy, collapse="|"), paste(slim_term, term)))

oxy.dat <- rbind(oxy.DEG,oxy.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  oxy.GO.plot <-  ggplot(oxy.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,534))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 8, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Oxidoreductase Activity")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/oxy.DMG.DEG.png"), plot=oxy.GO.plot, dpi=300, width=18, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/oxy.DMG.DEG.pdf"), plot=oxy.GO.plot, dpi=300, width=18, height=10, units="in")

```

#protein synthesis
```{r}

protein <- c("protein metabolic process", "protein folding", "protein", "protein modification process", "protein transport")

protein.DEG <-DEG.complete%>%
      filter(grepl(paste(protein, collapse="|"), paste(slim_term, term))) 

protein.DMG <- DMG.complete %>% 
      filter(grepl(paste(protein, collapse="|"), paste(slim_term, term)))

protein.dat <- rbind(protein.DEG,protein.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  protein.GO.plot <-  ggplot(protein.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,1500))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 30, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Protein Synthesis")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/protein.DMG.DEG.png"), plot=protein.GO.plot, dpi=300, width=20, height=24, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/protein.DMG.DEG.pdf"), plot=protein.GO.plot, dpi=300, width=20, height=24, units="in")

```

#glucose metabolism
```{r}

glucose <- c("glucose", "glucagon", "glucokinase", "glucocorticoid", "glucosinolate")

glucose.DEG <-DEG.complete%>%
      filter(grepl(paste(glucose, collapse="|"), paste(slim_term, term))) 

glucose.DMG <- DMG.complete %>% 
      filter(grepl(paste(glucose, collapse="|"), paste(slim_term, term)))

glucose.dat <- rbind(glucose.DEG,glucose.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  glucose.GO.plot <-  ggplot(glucose.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,20))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 30, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Glucose Metabolism")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/glucose.DMG.DEG.png"), plot=glucose.GO.plot, dpi=300, width=18, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/glucose.DMG.DEG.pdf"), plot=glucose.GO.plot, dpi=300, width=18, height=10, units="in")

```

#glutamate metabolism
```{r}

glutamate <- c("glutamate", "glutathione", "glutamylcyclotransferase", "hydroxymethylglutaryl", "glutathione")

glutamate.DEG <-DEG.complete%>%
      filter(grepl(paste(glutamate, collapse="|"), paste(slim_term, term))) 

glutamate.DMG <- DMG.complete %>% 
      filter(grepl(paste(glutamate, collapse="|"), paste(slim_term, term)))

glutamate.dat <- rbind(glutamate.DEG,glutamate.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  glutamate.GO.plot <-  ggplot(glutamate.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,200))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 30, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Glutamine Synthetase and Glutamate Synthase Pathway")+
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/glutamate.DMG.DEG.png"), plot=glutamate.GO.plot, dpi=300, width=18, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/glutamate.DMG.DEG.pdf"), plot=glutamate.GO.plot, dpi=300, width=18, height=10, units="in") 

```

#cellular energy metabolism
```{r}

cell <- c("sugar", "fatty acid", "lipid", "fatty")

cell.DEG <-DEG.complete%>%
      filter(grepl(paste(cell, collapse="|"), paste(slim_term, term))) 

cell.DMG <- DMG.complete %>% 
      filter(grepl(paste(cell, collapse="|"), paste(slim_term, term)))

cell.dat <- rbind(cell.DEG,cell.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
  cell.GO.plot <-  ggplot(cell.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,40))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 40, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Cellular Energy Metabolism") +
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/cell.DMG.DEG.png"), plot=cell.GO.plot, dpi=300, width=18, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/cell.DMG.DEG.pdf"), plot=cell.GO.plot, dpi=300, width=18, height=10, units="in")

```


#methithionie pathway
```{r}

methionine <- c("methionine", "methionyl", "methionine", "methyl", "SAM", "aden")

methionine.DEG <-DEG.complete%>%
      filter(grepl(paste(methionine, collapse="|"), paste(slim_term, term))) 

methionine.DMG <- DMG.complete %>% 
      filter(grepl(paste(methionine, collapse="|"), paste(slim_term, term)))

methionine.dat <- rbind(methionine.DEG,methionine.DMG)

  #plot significantly enriched GO terms by Slim Category faceted by slim term 
methionine.GO.plot <-  ggplot(methionine.dat, aes(x = type, y = term)) + 
    geom_point(aes(size=numInCat, fill=bh_adjust, colour=bh_adjust)) + 
    scale_size(name="Number of Genes", range=c(5,12), limits=c(1,300))+
    scale_fill_gradient(name = "Adjusted p-value", low="black", high="gray")+
    scale_colour_gradient(name = "Adjusted p-value", low="black", high="gray")+
    facet_grid(slim_term ~ ., scales = "free", space='free', labeller = label_wrap_gen(width = 40, multi_line = TRUE))+
    xlab("Analysis")+
    ggtitle("Methionine Pathway") +
    theme_bw() + 
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
          strip.background =element_rect(fill="white"),
          strip.text.y = element_text(angle=0, size = 18, face="bold"),
          strip.text.x = element_text(size = 16),
          axis.text.x = element_text(size = 20, angle=45, hjust=1),
          axis.text.y = element_text(size = 16),
          axis.title.x = element_text(size = 22, face="bold"),
          legend.text=element_text(size=16),
          title=element_text(size=22, face="bold"),
          plot.title = element_text(hjust = 0.4),
          axis.title.y = element_blank())
  

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/methionine.DMG.DEG.png"), plot=methionine.GO.plot, dpi=300, width=18, height=10, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/specific_pathways/methionine.DMG.DEG.pdf"), plot=methionine.GO.plot, dpi=300, width=18, height=10, units="in")

```

#use patchwork to combine figures and add labels

```{r}

Figure4 <- glucose.GO.plot + glutamate.GO.plot + oxy.GO.plot + plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = 50))
Figure5 <- nutrient.GO.plot + nitrogen.GO.plot + carb.GO.plot + heat.GO.plot + amino.GO.plot + protein.GO.plot + cell.GO.plot + methionine.GO.plot + plot_annotation(tag_levels = 'A') & theme(plot.tag = element_text(size = 50))
#Figure5 <- heat.GO.plot + amino.GO.plot + protein.GO.plot + cell.GO.plot + plot_annotation(tag_levels = 'A')
 
#ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/nitrogen.carb_pathways.png"), plot=Figure3, dpi=300, width=40, height=15, units="in")
#ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/nitrogen.carb_pathways.pdf"), plot=Figure3, dpi=300, width=40, height=15, units="in")

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/glut.oxy.pathways.png"), plot=Figure4, dpi=300, width=49, height=20, units="in")
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/glut.oxy.pathways.pdf"), plot=Figure4, dpi=300, width=49, height=20, units="in")

ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/full.fig.png"), plot=Figure5, dpi=300, width=60, height=55, units="in", limitsize = FALSE)
ggsave(filename=paste0("RAnalysis/Output/Final_Figures/Host/manuscript/full.fig.pdf"), plot=Figure5, dpi=300, width=60, height=55, units="in", limitsize = FALSE)
```
